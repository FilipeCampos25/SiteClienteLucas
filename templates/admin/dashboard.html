{% extends "base.html" %}

{% block content %}
<!-- ===== CABE√áALHO DO PAINEL ===== -->
<section class="admin-header">
  <div class="admin-header-content">
    <div>
      <h1 class="admin-title">Painel Administrativo</h1>
      <p class="admin-subtitle">Gerencie seus produtos e configura√ß√µes</p>
    </div>
    <div class="admin-stats">
      <div class="stat-badge">
        <span class="stat-number">{{ produtos|length }}</span>
        <span class="stat-text">Produtos</span>
      </div>
    </div>
  </div>
</section>

<!-- ===== SE√á√ÉO DE CRIAR PRODUTO ===== -->
<section class="admin-section">
  <div class="admin-card">
    <div class="card-header">
      <h2 class="card-title">
        <span class="card-icon">‚ûï</span>
        Criar Novo Produto
      </h2>
    </div>
    
    <form method="post" action="/admin/produto" class="admin-form">
      <div class="form-grid">
        <div class="form-group">
          <label for="nome" class="form-label">Nome do Produto *</label>
          <input 
            type="text" 
            id="nome" 
            name="nome" 
            class="form-input" 
            placeholder="Ex: Cantoneira de A√ßo 20x20" 
            required
          >
        </div>

        <div class="form-group">
          <label for="valor" class="form-label">Valor (R$) *</label>
          <input 
            type="number" 
            id="valor" 
            name="valor" 
            class="form-input" 
            placeholder="0.00" 
            step="0.01" 
            required
          >
        </div>

        <div class="form-group">
          <label for="imagem_url" class="form-label">URL da Imagem *</label>
          <input 
            type="url" 
            id="imagem_url" 
            name="imagem_url" 
            class="form-input" 
            placeholder="https://exemplo.com/imagem.jpg" 
            required
          >
        </div>

        <div class="form-group form-group-full">
          <label for="descricao" class="form-label">Descri√ß√£o</label>
          <textarea 
            id="descricao" 
            name="descricao" 
            class="form-textarea" 
            placeholder="Descreva as caracter√≠sticas do produto..."
            rows="4"
          ></textarea>
        </div>
      </div>

      <button type="submit" class="btn-submit">
        <span>‚úì</span> Criar Produto
      </button>
    </form>
  </div>
</section>

<!-- ===== SE√á√ÉO DE PRODUTOS EXISTENTES ===== -->
<section class="admin-section">
  <div class="admin-card">
    <div class="card-header">
      <h2 class="card-title">
        <span class="card-icon">üìã</span>
        Produtos Cadastrados
      </h2>
      {% if produtos %}
      <span class="card-badge">{{ produtos|length }} produtos</span>
      {% endif %}
    </div>

    {% if produtos %}
    <div class="products-table-wrapper">
      <table class="products-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Valor</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          {% for p in produtos %}
          <tr class="product-row" id="row-{{ p.id }}">
            <td class="cell-id">{{ p.id }}</td>
            <td class="cell-name">{{ p.nome }}</td>
            <td class="cell-price">R$ {{ '%.2f' % p.valor }}</td>
            <td class="cell-actions">
              <button 
                type="button" 
                class="btn-edit" 
                onclick="toggleEditForm({{ p.id }})"
              >
                ‚úèÔ∏è Editar
              </button>
              <form 
                style="display:inline;" 
                method="post" 
                action="/admin/produto/{{ p.id }}" 
                onsubmit="return confirm('Tem certeza que deseja deletar este produto?');"
              >
                <input type="hidden" name="_method" value="DELETE">
                <button type="submit" class="btn-delete">
                  üóëÔ∏è Deletar
                </button>
              </form>
            </td>
          </tr>

          <!-- ===== FORMUL√ÅRIO DE EDI√á√ÉO ===== -->
          <tr class="edit-form-row" id="edit-row-{{ p.id }}" style="display:none;">
            <td colspan="4">
              <form 
                id="edit-form-{{ p.id }}" 
                method="post" 
                action="/admin/produto/{{ p.id }}" 
                class="edit-form"
              >
                <input type="hidden" name="_method" value="PUT">

                <div class="edit-form-grid">
                  <div class="form-group">
                    <label for="edit-nome-{{ p.id }}" class="form-label">Nome</label>
                    <input 
                      type="text" 
                      id="edit-nome-{{ p.id }}" 
                      name="nome" 
                      value="{{ p.nome }}" 
                      class="form-input" 
                      required
                    >
                  </div>

                  <div class="form-group">
                    <label for="edit-valor-{{ p.id }}" class="form-label">Valor</label>
                    <input 
                      type="number" 
                      id="edit-valor-{{ p.id }}" 
                      name="valor" 
                      value="{{ p.valor }}" 
                      class="form-input" 
                      step="0.01"
                      required
                    >
                  </div>

                  <div class="form-group">
                    <label for="edit-imagem-{{ p.id }}" class="form-label">URL da Imagem</label>
                    <input 
                      type="url" 
                      id="edit-imagem-{{ p.id }}" 
                      name="imagem_url" 
                      value="{{ p.imagem_url }}" 
                      class="form-input" 
                      required
                    >
                  </div>

                  <div class="form-group form-group-full">
                    <label for="edit-descricao-{{ p.id }}" class="form-label">Descri√ß√£o</label>
                    <textarea 
                      id="edit-descricao-{{ p.id }}" 
                      name="descricao" 
                      class="form-textarea" 
                      rows="3"
                    >{{ p.descricao }}</textarea>
                  </div>
                </div>

                <div class="edit-form-actions">
                  <button type="submit" class="btn-save">
                    ‚úì Salvar Altera√ß√µes
                  </button>
                  <button 
                    type="button" 
                    class="btn-cancel" 
                    onclick="toggleEditForm({{ p.id }})"
                  >
                    ‚úï Cancelar
                  </button>
                </div>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state-admin">
      <div class="empty-icon">üì¶</div>
      <p class="empty-title">Nenhum produto cadastrado</p>
      <p class="empty-text">Crie seu primeiro produto usando o formul√°rio acima</p>
    </div>
    {% endif %}
  </div>
</section>

<!-- ===== SCRIPT ===== -->
<script>
function toggleEditForm(id) {
  const editRow = document.getElementById('edit-row-' + id);
  const productRow = document.getElementById('row-' + id);
  
  if (editRow.style.display === 'none') {
    editRow.style.display = 'table-row';
    productRow.style.opacity = '0.5';
    productRow.style.pointerEvents = 'none';
  } else {
    editRow.style.display = 'none';
    productRow.style.opacity = '1';
    productRow.style.pointerEvents = 'auto';
  }
}
</script>

{% endblock %}
