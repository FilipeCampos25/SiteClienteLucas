{% extends "base.html" %}

{% block content %}
<!-- ===== CABE√áALHO DO PAINEL ADMIN ===== -->
<section class="admin-header">
  <h1 class="admin-title">Painel Administrativo</h1>
  <p class="admin-subtitle">Gerencie seus produtos e configura√ß√µes</p>
</section>

<!-- ===== SE√á√ÉO DE CRIA√á√ÉO DE PRODUTO ===== -->
<section class="admin-section">
  <div class="admin-card">
    <h2 class="admin-card-title">‚ûï Criar Novo Produto</h2>
    
    <form method="post" action="/admin/produto" class="admin-form">
      <!-- IMPORTANTE: N√£o altere os nomes dos campos (name="...") pois eles devem corresponder ao backend -->
      
      <div class="form-group">
        <label for="nome" class="form-label">Nome do Produto *</label>
        <input 
          type="text" 
          id="nome" 
          name="nome" 
          class="form-input" 
          placeholder="Ex: Cantoneira de A√ßo 20x20" 
          required
          aria-label="Nome do produto"
        >
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="valor" class="form-label">Valor (R$) *</label>
          <input 
            type="number" 
            id="valor" 
            name="valor" 
            class="form-input" 
            placeholder="0.00" 
            step="0.01" 
            required
            aria-label="Valor do produto"
          >
        </div>

        <div class="form-group">
          <label for="imagem_url" class="form-label">URL da Imagem *</label>
          <input 
            type="url" 
            id="imagem_url" 
            name="imagem_url" 
            class="form-input" 
            placeholder="https://exemplo.com/imagem.jpg" 
            required
            aria-label="URL da imagem do produto"
          >
        </div>
      </div>

      <div class="form-group">
        <label for="descricao" class="form-label">Descri√ß√£o</label>
        <textarea 
          id="descricao" 
          name="descricao" 
          class="form-textarea" 
          placeholder="Descreva as caracter√≠sticas do produto..."
          rows="4"
          aria-label="Descri√ß√£o do produto"
        ></textarea>
      </div>

      <button type="submit" class="btn-submit">
        ‚úì Criar Produto
      </button>
    </form>
  </div>
</section>

<!-- ===== SE√á√ÉO DE PRODUTOS EXISTENTES ===== -->
<section class="admin-section">
  <div class="admin-card">
    <h2 class="admin-card-title">üìã Produtos Existentes</h2>

    {% if produtos %}
    <div class="products-table-wrapper">
      <table class="products-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Valor</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          {% for p in produtos %}
          <tr class="product-row" id="row-{{ p.id }}">
            <td class="table-cell-id">{{ p.id }}</td>
            <td class="table-cell-name">{{ p.nome }}</td>
            <td class="table-cell-price">R$ {{ '%.2f' % p.valor }}</td>
            <td class="table-cell-actions">
              <!-- Bot√£o Editar -->
              <button 
                type="button" 
                class="btn-edit" 
                onclick="toggleEditForm({{ p.id }})"
                aria-label="Editar produto {{ p.nome }}"
              >
                ‚úèÔ∏è Editar
              </button>

              <!-- Bot√£o Deletar -->
              <form 
                style="display:inline;" 
                method="post" 
                action="/admin/produto/{{ p.id }}" 
                onsubmit="return confirm('Tem certeza que deseja deletar este produto?');"
              >
                <input type="hidden" name="_method" value="DELETE">
                <button type="submit" class="btn-delete" aria-label="Deletar produto {{ p.nome }}">
                  üóëÔ∏è Deletar
                </button>
              </form>
            </td>
          </tr>

          <!-- ===== FORMUL√ÅRIO DE EDI√á√ÉO (ESCONDIDO) ===== -->
          <tr class="edit-form-row" id="edit-row-{{ p.id }}" style="display:none;">
            <td colspan="4">
              <form 
                id="edit-form-{{ p.id }}" 
                method="post" 
                action="/admin/produto/{{ p.id }}" 
                class="admin-form-edit"
              >
                <!-- IMPORTANTE: N√£o altere os nomes dos campos (name="...") pois eles devem corresponder ao backend -->
                <input type="hidden" name="_method" value="PUT">

                <div class="edit-form-group">
                  <label for="edit-nome-{{ p.id }}" class="form-label">Nome</label>
                  <input 
                    type="text" 
                    id="edit-nome-{{ p.id }}" 
                    name="nome" 
                    value="{{ p.nome }}" 
                    class="form-input-edit" 
                    placeholder="Nome"
                    required
                  >
                </div>

                <div class="edit-form-group">
                  <label for="edit-valor-{{ p.id }}" class="form-label">Valor</label>
                  <input 
                    type="number" 
                    id="edit-valor-{{ p.id }}" 
                    name="valor" 
                    value="{{ p.valor }}" 
                    class="form-input-edit" 
                    placeholder="Valor" 
                    step="0.01"
                    required
                  >
                </div>

                <div class="edit-form-group">
                  <label for="edit-imagem-{{ p.id }}" class="form-label">URL da Imagem</label>
                  <input 
                    type="url" 
                    id="edit-imagem-{{ p.id }}" 
                    name="imagem_url" 
                    value="{{ p.imagem_url }}" 
                    class="form-input-edit" 
                    placeholder="URL imagem"
                    required
                  >
                </div>

                <div class="edit-form-group">
                  <label for="edit-descricao-{{ p.id }}" class="form-label">Descri√ß√£o</label>
                  <textarea 
                    id="edit-descricao-{{ p.id }}" 
                    name="descricao" 
                    class="form-textarea-edit" 
                    placeholder="Descri√ß√£o"
                    rows="3"
                  >{{ p.descricao }}</textarea>
                </div>

                <div class="edit-form-actions">
                  <button type="submit" class="btn-save">
                    ‚úì Salvar Altera√ß√µes
                  </button>
                  <button 
                    type="button" 
                    class="btn-cancel" 
                    onclick="toggleEditForm({{ p.id }})"
                  >
                    ‚úï Cancelar
                  </button>
                </div>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state-admin">
      <p class="empty-state-text">Nenhum produto cadastrado ainda.</p>
      <p class="empty-state-hint">Crie seu primeiro produto usando o formul√°rio acima.</p>
    </div>
    {% endif %}
  </div>
</section>

<!-- ===== SCRIPT DE CONTROLE DO FORMUL√ÅRIO DE EDI√á√ÉO ===== -->
<script>
/**
 * IMPORTANTE: N√£o altere esta fun√ß√£o pois ela controla a exibi√ß√£o/oculta√ß√£o do formul√°rio de edi√ß√£o
 * Ela √© essencial para o funcionamento do painel admin
 */
function toggleEditForm(id) {
  const editRow = document.getElementById('edit-row-' + id);
  const productRow = document.getElementById('row-' + id);
  
  if (editRow.style.display === 'none') {
    editRow.style.display = 'table-row';
    productRow.style.opacity = '0.5';
    productRow.style.pointerEvents = 'none';
  } else {
    editRow.style.display = 'none';
    productRow.style.opacity = '1';
    productRow.style.pointerEvents = 'auto';
  }
}
</script>

{% endblock %}
